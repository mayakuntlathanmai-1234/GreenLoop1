<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GreenLoop Dashboard </title>
  <!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      
    }
   header {
  /* background: #66ea6f; */
  color: white;
  padding: 1rem;
  text-align: center;
  position: relative;
}

.header-container {
  display: flex;
  align-items: center;
  justify-content: center; /* centers the title */
  position: relative;
}

.logo {
  position: absolute;
    left: 25px; /* stick logo to left corner */
  width: 20px;
  height: 20px; 
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid white;
}

.subtitle {
  margin: 0.5rem 0 0;
}


    header {
      /* background: #39b641; */
      color: #39b641;
      /* padding: 1rem; */
      text-align: left;
    }

    section {
      padding: 2rem;
      max-width: 1200px;
      margin: auto;
    }

    h2 {
      color: #2e7d32;
      margin-bottom: 1rem;
    }

    /* Filter input */
    #filterInput {
      padding: 0.5rem;
      margin-bottom: 1rem;
      width: 100%;
      max-width: 300px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    }

    table th, table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: center;
    }

    table th {
      background: #388e3c;
      color: white;
    }

    tr:nth-child(even) {
      background: #f9f9f9;
    }

    /* Status colors */
    .status-pending {
      color: #d32f2f;
      font-weight: bold;
    }
    .status-inprogress {
      color: #fbc02d;
      font-weight: bold;
    }
    .status-resolved {
      color: #388e3c;
      font-weight: bold;
    }

    /* Map placeholder */
    #map {
      margin-top: 2rem;
      height: 300px;
      background: #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #555;
      font-size: 1.2rem;
      border-radius: 10px;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: #167d1b;
      color: white;
      margin-top: 2rem;
    }

    /* Responsive table */
    @media(max-width: 768px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }

      th {
        position: sticky;
        top: 0;
        background: #388e3c;
      }

      td {
        border: none;
        padding: 10px;
        text-align: left;
      }

      tr {
        margin-bottom: 1rem;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        border-radius: 8px;
        padding: 10px;
      }
    }

    /* header / navbar overrides for admin dashboard */
    .admin-header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:14px 20px;
      background:linear-gradient(90deg,#ffffff,#f3fff4);
      border-bottom:1px solid #e6f4ea;
      box-shadow:0 6px 18px rgba(12,18,33,0.03);
      position:sticky;
      top:0;
      z-index:50;
    }
    .admin-header .brand {
      display:flex;
      align-items:center;
      gap:12px;
    }
    .admin-header .brand img {
      width:44px;height:44px;border-radius:8px;object-fit:cover;border:2px solid #e6f4ea;
    }
    .admin-header .brand .title {
      font-weight:700;color:#158038;font-size:18px;
      line-height:1;
    }
    .admin-header nav {
      display:flex;
      gap:8px;
      align-items:center;
      margin-left:20px;
    }
    .admin-header a.nav-link {
      padding:8px 12px;border-radius:8px;text-decoration:none;color:#2f4f2f;font-weight:600;
      background:transparent;border:1px solid transparent;
    }
    .admin-header a.nav-link:hover { background:#fff;border-color:#e8f7ec;box-shadow:0 6px 18px rgba(12,18,33,0.04) }
    .admin-header .right { display:flex;align-items:center;gap:10px }
    .admin-header .logout { padding:8px 10px;background:#fff;border:1px solid #e6efe9;border-radius:8px;color:#155724;font-weight:700;text-decoration:none }
    .admin-header .public-link { font-size:13px;color:#6b7280;text-decoration:none;padding:6px 10px;border-radius:8px }
    @media(max-width:720px){
      .admin-header { flex-direction:column;align-items:flex-start;gap:10px }
      .admin-header nav{flex-wrap:wrap}
    }
  </style>
</head>
<body>
  <!-- REPLACED header with professional admin header -->
  <header class="admin-header" role="banner">
    <div class="brand">
      <a href="index.html" style="display:inline-flex;align-items:center;text-decoration:none;color:inherit;">
        <!-- <img src="../logo.png" alt="GreenLoop logo" /> -->
        <div>
          <div class="title">GreenLoop Admin</div>
          <div style="font-size:12px;color:#6b7280">Dashboard</div>
        </div>
      </a>
    </div>

    <nav aria-label="Admin primary">
      <a class="nav-link" href="admin_dashboard .html">Dashboard</a>
      <a class="nav-link" href="admin_events.html">Events</a>
      <a class="nav-link" href="index.html">Profile</a>
      <a class="nav-link" href="../event.html" title="View public events">Public Events</a>
    </nav>

    <div class="right">
      <a class="public-link" href="../Home.html" target="_blank" rel="noopener">Open site</a>
      <a class="logout" href="../admin_logout.html">Sign out</a>
    </div>
  </header>
  <section>
    <h2>Submitted Reports</h2>

    <!-- Filter -->
    <input type="text" id="filterInput" placeholder="Filter by name, id or location..." />

    <!-- Table -->
    <table id="reportTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Waste Type</th>
          <th>Location</th>
          <th>Details</th>
          <th>Photo</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- populated by JS -->
      </tbody>
    </table>

    <!-- Feedbacks -->
    <h2 style="margin-top:22px">User Feedback</h2>
    <div id="feedbackList" style="margin-top:10px">
      <!-- feedback items injected here -->
    </div>

    <!-- Map placeholder -->
    <div id="map">Map placeholder (integrate Google Maps / Leaflet here)</div>
  </section>

  <footer>
    <p>&copy; 2025 GreenLoop Lite | Prototype Dashboard</p>
  </footer>

  <script>
    (function(){
      const RKEY = 'greenloop_reports_v1';
      const FKEY = 'greenloop_feedbacks_v1';
      const tbody = document.querySelector('#reportTable tbody');
      const filterInput = document.getElementById('filterInput');
      const feedbackListEl = document.getElementById('feedbackList');

      function loadReports(){ try{ return JSON.parse(localStorage.getItem(RKEY)||'[]'); }catch(e){return[]} }
      function saveReports(list){ try{ localStorage.setItem(RKEY, JSON.stringify(list)); }catch(e){} renderReports(); }
      function loadFeedbacks(){ try{ return JSON.parse(localStorage.getItem(FKEY)||'[]'); }catch(e){return[]} }
      function saveFeedbacks(list){ try{ localStorage.setItem(FKEY, JSON.stringify(list)); }catch(e){} renderFeedbacks(); }

      function renderReports(){
        const q = filterInput.value.trim().toLowerCase();
        const items = loadReports();
        tbody.innerHTML = '';
        if (!items.length){
          tbody.innerHTML = '<tr><td colspan="7">No reports yet.</td></tr>';
          return;
        }
        items.forEach((r, idx) => {
          if (q && !(r.id.toLowerCase().includes(q) || (r.location||'').toLowerCase().includes(q) || (r.wasteType||'').toLowerCase().includes(q))) return;
          const tr = document.createElement('tr');

          const photoCell = r.photo ? `<img src="${r.photo}" style="width:80px;height:56px;object-fit:cover;border-radius:6px"/>` : 'No Photo';
          const statusClass = r.status === 'Pending' ? 'status-pending' : (r.status === 'In Progress' ? 'status-inprogress' : 'status-resolved');

          tr.innerHTML = `<td>${r.id}</td>
            <td>${r.wasteType || ''}</td>
            <td>${r.location || ''}</td>
            <td style="max-width:220px;text-align:left">${(r.desc||'')}</td>
            <td>${photoCell}</td>
            <td class="${statusClass}">${r.status}</td>
            <td>
              <div style="display:flex;gap:6px;flex-direction:column">
                <button data-idx="${idx}" data-act="progress">In progress</button>
                <button data-idx="${idx}" data-act="resolve">Resolve</button>
                <button data-idx="${idx}" data-act="delete" style="background:#fff;border:1px dashed #ddd">Delete</button>
              </div>
            </td>`;

          tbody.appendChild(tr);
        });

        // attach handlers
        tbody.querySelectorAll('button[data-act]').forEach(btn=>{
          btn.addEventListener('click', ()=>{
            const idx = Number(btn.getAttribute('data-idx'));
            const act = btn.getAttribute('data-act');
            const items = loadReports();
            const report = items[idx];
            if (!report) return;
            if (act === 'delete'){
              if (!confirm('Delete this report?')) return;
              items.splice(idx,1);
              saveReports(items);
            } else if (act === 'progress'){
              report.status = 'In Progress';
              items[idx] = report;
              saveReports(items);
            } else if (act === 'resolve'){
              report.status = 'Resolved';
              report.resolvedAt = new Date().toISOString();
              // allow feedback submission by users
              items[idx] = report;
              saveReports(items);
              alert('Marked resolved — users who submitted that report will be able to leave feedback.');
            }
          });
        });
      }

      function renderFeedbacks(){
        const fb = loadFeedbacks();
        if (!fb.length){
          feedbackListEl.innerHTML = '<div class="muted">No feedback yet.</div>';
          return;
        }
        feedbackListEl.innerHTML = fb.map(f => {
          return `<div style="padding:10px;border-radius:8px;border:1px solid #eef6ee;background:#fff;margin-bottom:8px">
            <div style="font-weight:700">${f.reportId} — ${f.name||'Anonymous'}</div>
            <div style="color:#6b7280;font-size:13px;margin-top:6px">${f.message}</div>
            <div style="color:#9aa3ad;font-size:12px;margin-top:8px">Submitted: ${new Date(f.createdAt).toLocaleString()}</div>
          </div>`;
        }).join('');
      }

      filterInput.addEventListener('input', renderReports);

      // initial render and react to storage changes
      renderReports();
      renderFeedbacks();
      window.addEventListener('storage', function(e){
        if (!e.key || e.key === RKEY) renderReports();
        if (!e.key || e.key === FKEY) renderFeedbacks();
      });
    })();
  </script>

  <script>
  // Initialize map centered at sample location (existing code)
  const map = L.map('map').setView([16.4998469,80.6560164 ], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap contributors' }).addTo(map);
  </script>
</body>
</html>
